/*
 a. ?va.? v À¯?Esq.?? ?2©Åƒ -Eoe¼? ?!˜ñ¥PËÏ? ›Año? j½‡` Al? 

1. ??ir\ÔïBìëÒ¡G~Î ´j³õuë§e 5ÎÐ? ×þ¶tººVOP°R*àÙ=p Ö?,¢E-Q? 2 V–HñÊHe —Š B? 

 

Üõáf?"ˆh (¿¿¿Su???/ (?j—ß+? =Té¶)tú¡¥¿ì [ÿ v:kk? ? ¿X? ó¯†¢? ¿A?0? ? R aÿ?d` 

ŸIYQ?:v-? B^ % Rì±??b$ ?t&_» MR dtZƒu/? ?<F…Û›£?ÐÞfh^{?>U/= %þ?? 

T‰Îƒº“š¢sÏ©j ¼ö? ? Gÿ??4Rg? ?ÿ??1UËÖ¹Ç? }?0]UE¼”? ¤OEC– 

êÜªZ? 41;?"??Ûìå¸??ÿ?>?3¿x?!?š˜‰ªB‡â?QμÍg ?? ?±âË¦? ? s ?ÿF?&Ç¬ U, ?T›C¤….¨¾?ýß 

?3?? »ú~ zžýÿ?±U Q? L¢HŠë*?(¿¿ÃÍ?? ÅU?  :? l¹ž;,?^? h% ?3?_˜V±J ³«v Có× ‡ à²]b? y?É¿ÝÂ…Â é???3? ?<mWn?UμË÷ï?Z?/? ? LÚÚ? ©OEº’W™BY :'b™Q 6 ?6?5? ¿S ìOgOX¯vï³ýß? ÿ?? ¢”7§h€ BHi ? p åB?ÿ?d^ %A? }?% ? ` 

Q‡Y?.Z??!€ n>? ?g? t·J? £Š?0±Æ±E ŠŽ ¯f Ò¥ªïæ ?|?,g ? ? šˆ?? {2. R.·´þ¡ 

“uðí€|?!} Õ×& ‹ÜÇ? %YQ³a¼“],?) $? ?Ap. " È+ ôä?7[£u"?)??êºÜÍ 

[›»*id'ÙÓŸÙdZƒf???¦Ÿ?oO§N? M ŸÝê‰í0?$?³è` μ¡ ?¤Act? `Ãˆ £Q? ¾c ?+? :? ¸ë 

©a4?97C ´Æ D "(?Y ? D@"™S=W? ? nail !Åì3€ S I—¬?¿åÌ3€ s i—¬?k.¨N?‹Ü?.?"? )e~+ ?apt' î?Þ«“ØFÝ¹:Æ³%Ü×‰Rag? ?? CgC'yêÙ?4à²DC¡¥ Hid ’?+»¾+» ¾A'øÊ? ion^¶x?ÿ6? ÿgoeì!ÐÓkx? å¨A¥F_{ m j ÿ?db? ?S“O?'@Hp b ] PláãÀª€b? *:( c]A± 

?(?6X „”âóy Çb?0Óí?©ŸÂdà¶ ‚ZÅ¶¥j)? æèG”Ñ]½P?( Ð÷ V n =7‰¬xQ 

?/???.?9.?_ûÎ?2mn/ÿmY•ú×ù?ÿk‘Ìc9>g ¬áþª“{Z?#A{A {ct ?xà°¨«μž‘qZ? °Ó…z ?Š¢ ±K ÔïBìëÒ¡G~Î ´j³õuë§e 5ÎÐ? ×þ¶tººVOP°R*àÙ=p Ö?,¢E-Q? 2 V–HñÊ —Š B? 

Ì´??;¼â¥ŽX?=ˆÂ? „’¨OE¨£??´áK«ÍU ‹Ìu?”ýeÿ?4? CGEÀ“ ÿøó? Gÿ ? Ã3u°ÛC? 

ÜõÁf?"ˆh(X?u???/ (?j—ß+?=Tü¶)uÚÅ¡¥¿ì[ÿ v:kk? ? X ? ó¯†¢? A?0? ? R aÿ?d` ŸIYQ?:v- ? B^ % Rì±??b$ ?t&_ »MR dtZƒu/? ?<F…Û›£?ÐÞfh^{?>U/= %þ ?? 

T‰Îƒº“š¢sÏ©j ¼ö? ? Gÿ??4Rg? ?ÿ??1UËÖ¹Ç? }?0]UE¼”? ¤OEC– êÜªZ?41;?êÜªZ? 41;?"??Ûìå¸?¾uJ?ÿuJ? ÿ«ÙFf´î¶´ z? @^? ? ) z lmB\? ?éÒ?8)Åx]??Öýit‚†? ó¶K7 

? ; ?‘P ;?? |? ?) x9‡Ñ†Zªcui? {?9 ?<?EºÚEmú ? oe³Vfè ?¼Ù0Çà3g (> ô´d’á ?CL¥Éc?4 

Q$[? ’a 9•Ýk[?;ª£ »ïÿl? s3iN??ÿþêm? @0cÁ¹/?# t? ¶Ô5? ? Nªk•Úº°f?( F=(? I; 

?->OYeU ìâÒØ¢•v]]? f?ÿ?dw /AU?)m?'? ? ` N?? ?€"?.j y?8? ?2?§jH“c l?O 

_? ?6TYþø?AÈ¢u?ÿ* To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package encriptadoaes;

import java.io.UnsupportedEncodingException;
import java.security.InvalidKeyException;
import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;
import java.util.Arrays;
import java.util.Base64;
import javax.crypto.BadPaddingException;
import javax.crypto.Cipher;
import javax.crypto.IllegalBlockSizeException;
import javax.crypto.NoSuchPaddingException;
import javax.crypto.spec.SecretKeySpec;

/**
 *
 * @author david
 */
public class EncriptadorAES {

    /**
     * Crea la clave de encriptacion usada internamente
     * @param clave Clave que se usara para encriptar
     * @return Clave de encriptacion
     * @throws UnsupportedEncodingException
     * @throws NoSuchAlgorithmException 
     */
    private SecretKeySpec crearClave(String clave) throws UnsupportedEncodingException, NoSuchAlgorithmException {
        byte[] claveEncriptacion = clave.getBytes("UTF-8");
        
        MessageDigest sha = MessageDigest.getInstance("SHA-1");
        
        claveEncriptacion = sha.digest(claveEncriptacion);
        claveEncriptacion = Arrays.copyOf(claveEncriptacion, 16);
        
        SecretKeySpec secretKey = new SecretKeySpec(claveEncriptacion, "AES");

        return secretKey;
    }

    /**
     * Aplica la encriptacion AES a la cadena de texto usando la clave indicada
     * @param datos Cadena a encriptar
     * @param claveSecreta Clave para encriptar
     * @return Información encriptada
     * @throws UnsupportedEncodingException
     * @throws NoSuchAlgorithmException
     * @throws InvalidKeyException
     * @throws NoSuchPaddingException
     * @throws IllegalBlockSizeException
     * @throws BadPaddingException 
     */
    public String encriptar(String datos, String claveSecreta) throws UnsupportedEncodingException, NoSuchAlgorithmException, InvalidKeyException, NoSuchPaddingException, IllegalBlockSizeException, BadPaddingException {
        SecretKeySpec secretKey = this.crearClave(claveSecreta);
        
        Cipher cipher = Cipher.getInstance("AES/ECB/PKCS5Padding");        
        cipher.init(Cipher.ENCRYPT_MODE, secretKey);

        byte[] datosEncriptar = datos.getBytes("UTF-8");
        byte[] bytesEncriptados = cipher.doFinal(datosEncriptar);
        String encriptado = Base64.getEncoder().encodeToString(bytesEncriptados);

        return encriptado;
    }

    /**
     * Desencripta la cadena de texto indicada usando la clave de encriptacion
     * @param datosEncriptados Datos encriptados
     * @param claveSecreta Clave de encriptacion
     * @return Informacion desencriptada
     * @throws UnsupportedEncodingException
     * @throws NoSuchAlgorithmException
     * @throws InvalidKeyException
     * @throws NoSuchPaddingException
     * @throws IllegalBlockSizeException
     * @throws BadPaddingException 
     */
    public String desencriptar(String datosEncriptados, String claveSecreta) throws UnsupportedEncodingException, NoSuchAlgorithmException, InvalidKeyException, NoSuchPaddingException, IllegalBlockSizeException, BadPaddingException {
        SecretKeySpec secretKey = this.crearClave(claveSecreta);

        Cipher cipher = Cipher.getInstance("AES/ECB/PKCS5PADDING");
        cipher.init(Cipher.DECRYPT_MODE, secretKey);
        
        byte[] bytesEncriptados = Base64.getDecoder().decode(datosEncriptados);
        byte[] datosDesencriptados = cipher.doFinal(bytesEncriptados);
        String datos = new String(datosDesencriptados);
        
        return datos;
    }
}
